import{u as S,j as d,O as Y,a as t,H as I,Q as K,y as B,S as z,U as te,V as ae,W as F,X as ne,Y as Q,z as U,A as b,Z as T,_,$ as V,a0 as A,a1 as k,a2 as D,a3 as oe,a4 as ie,a5 as se,c as x,a6 as re,a7 as le,a8 as ce,a9 as de,aa as me,w as he,N as ue,r as pe}from"./vendor-5d1a92ce.js";import{a as G,u as L,b as fe,c as ge,A as X,d as ve,e as ye,f as Ce,g as be,h as we,r as Me,i as je,j as Se,t as E,k as xe}from"./index-86775f8e.js";import{u as W,I as $,G as ze,E as Le}from"./constant-a8a17384.js";function Ne(){const{t:e,i18n:a}=S(),n=W(),i=G(),{companyConfig:s}=L(c=>c.app),{company:m,newCompany:o,companyName:r}=L(c=>c.ticket),l={...s.map(c=>[c.id,n(c.name)]).sort((c,f)=>c[1].localeCompare(f[1],a.languages[0])).reduce((c,f)=>({...c,[f[0]]:f[1]}),{"":e("Please select...")}),new:e("Add a company...")},p=[{type:"select",label:e("Company"),value:m,options:l,disabledOptions:[""],onChange:c=>i(fe(c))},{type:"input",label:e("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:o,onChange:c=>i(ge(c)),hidden:m!=="new"}],g=Object.entries(X).map(c=>{const f=c[0],u=c[1];return{type:"input",label:e(u),value:r[f],onChange:C=>i(ve({lang:f,name:C}))}});return d(Y,{as:"section",children:[t(I,{as:"h5",size:"sm",mb:2,children:e("Railway company")}),d(K,{direction:"column",children:[t(B,{fields:p}),m==="new"&&t(B,{fields:g})]})]})}const Ee=e=>new Promise(a=>{const n=new FileReader;n.onloadend=()=>a(n.result),n.readAsText(e)});var Z={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},q=z.createContext&&z.createContext(Z),j=globalThis&&globalThis.__assign||function(){return j=Object.assign||function(e){for(var a,n=1,i=arguments.length;n<i;n++){a=arguments[n];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},j.apply(this,arguments)},Oe=globalThis&&globalThis.__rest||function(e,a){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&a.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)a.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]]);return n};function ee(e){return e&&e.map(function(a,n){return z.createElement(a.tag,j({key:n},a.attr),ee(a.child))})}function N(e){return function(a){return z.createElement(Te,j({attr:j({},e.attr)},a),ee(e.child))}}function Te(e){var a=function(n){var i=e.attr,s=e.size,m=e.title,o=Oe(e,["attr","size","title"]),r=s||n.size||"1em",l;return n.className&&(l=n.className),e.className&&(l=(l?l+" ":"")+e.className),z.createElement("svg",j({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,i,o,{className:l,style:j(j({color:e.color||n.color},n.style),e.style),height:r,width:r,xmlns:"http://www.w3.org/2000/svg"}),m&&z.createElement("title",null,m),e.children)};return q!==void 0?z.createElement(q.Consumer,null,function(n){return a(n)}):a(Z)}function ke(e){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}}]})(e)}function Ie(e){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}}]})(e)}function Be(e){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}}]})(e)}function Re(e){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}}]})(e)}function He(e){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}}]})(e)}function Pe(e){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}}]})(e)}function Je(e){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}}]})(e)}function Ae(e){const{company:a,templateEntry:n,onLineChange:i,onNewLineChange:s,onMajorFlagChange:m,onLineNameChange:o,onParamChange:r,onRemove:l}=e,{line:p,newLine:g,majorUpdate:c,templateName:f}=n,{t:u}=S(),C=W(),{templateList:O}=L(h=>h.app),w=async h=>{var y;const v=(y=h.target.files)==null?void 0:y[0];if(console.log("handleFileUpload():: received file",v),!!v){if(v.type!=="application/json"){alert("Invalid file type!"),h.target.value="";return}try{const M=await Ee(v);r(JSON.parse(M))}catch(M){alert("Invalid file!"),h.target.value=""}}},R={"":u("Please select..."),...a===""||a==="new"?{}:O[a].reduce((h,v)=>({...h,[v.filename]:C(v.name)}),{}),new:u("Add a line...")},H=[{type:"select",label:u("Line"),value:p,options:R,disabledOptions:[""],onChange:h=>i(h),minW:150},{type:"custom",label:u("Configuration file"),component:t(te,{variant:"flushed",size:"xs",type:"file",accept:".json",onChange:w}),minW:250},{type:"input",label:u("Line code"),placeholder:"e.g. twl, gz1, sh1",value:g,onChange:h=>s(h),hidden:p!=="new"},{type:"switch",label:u("Major update"),isChecked:c,onChange:h=>m(h),hidden:p==="new",oneLine:!0}],P=Object.entries(X).map(h=>{const v=h[0],y=h[1];return{type:"input",label:u(y),value:f[v],onChange:M=>o(v,M)}});return d(K,{position:"relative",direction:"column",children:[t(ae,{size:"sm",variant:"ghost",icon:t(Je,{}),"aria-label":u("Remove this line"),title:u("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:l}),t(B,{fields:[...H,...P],minW:110})]})}function Fe(){const{t:e}=S(),a=G(),{templateList:n}=L(o=>o.app),{company:i,templates:s}=L(o=>o.ticket),m=(o,r)=>{var p;const l=(p=n[i])==null?void 0:p.find(g=>g.filename===r);a(Se({id:o,line:r,name:l==null?void 0:l.name}))};return d(Y,{as:"section",mt:3,children:[d(F,{children:[t(I,{as:"h5",size:"sm",mb:2,children:e("Add or update templates")}),t(ne,{hasArrow:!0,label:e("Toggling on 'Major update' will update the uploader field of the template and you are required enter extra justification for it."),children:t("span",{children:t(Q,{as:ke,ml:1})})})]}),s.map(o=>t(Ae,{company:i,templateEntry:o,onLineChange:r=>m(o.id,r),onNewLineChange:r=>a(ye({id:o.id,newLine:r})),onMajorFlagChange:r=>a(Ce({id:o.id,majorUpdate:r})),onLineNameChange:(r,l)=>a(be({id:o.id,lang:r,name:l})),onParamChange:r=>a(we({id:o.id,param:r})),onRemove:()=>a(Me(o.id))},o.id)),t(U,{justifyContent:"flex-end",children:t(b,{variant:"ghost",size:"sm",leftIcon:t(Be,{}),onClick:()=>a(je()),children:e("Add item")})})]})}function Ue(e){const{companyErrors:a,templateErrors:n,onClose:i}=e,{t:s}=S(),m=W();return d(T,{children:[d(_,{children:[t(V,{children:s("Your inputs contain the following errors. Please fix it before submitting.")}),a.length>0&&d(T,{children:[t(I,{as:"h5",size:"sm",my:2,children:s("Railway company")}),t(A,{"aria-label":"List of company errors",children:a.map((o,r)=>t(k,{children:m($[o])},r))})]}),Object.values(n).flat().length>0&&d(T,{children:[t(I,{as:"h5",size:"sm",my:2,children:s("Templates")}),t(A,{"aria-label":"List of template errors",children:Object.entries(n).map(([o,r])=>d(k,{children:[o,t(A,{children:r.map((l,p)=>t(k,{children:m($[l])},p))})]},o))})]})]}),t(D,{children:t(U,{children:t(b,{colorScheme:"primary",onClick:i,children:s("Go back")})})})]})}function _e(e){const{justification:a,majorUpdateJustifications:n,onJustificationChange:i,onMajorUpdateJustificationChange:s,onNext:m}=e,{t:o}=S(),r=[{type:"textarea",value:a,label:o("Justification"),placeholder:o("Briefly describe your changes and provide justification"),onChange:i}],l=Object.entries(n).map(([g,c])=>({type:"textarea",value:c,label:o("Justification for major update of")+" "+g,placeholder:o("Briefly describe your changes and provide justification"),onChange:f=>s(g,f)})),p=!a||Object.values(n).some(g=>!g);return d(T,{children:[d(_,{children:[t(V,{children:o("Please provide suitable source and justification.")}),t(B,{fields:[...r,...l],minW:"full"})]}),t(D,{children:t(b,{colorScheme:"primary",onClick:m,rightIcon:t(Pe,{}),isDisabled:p,children:o("Next")})})]})}function Ve(e){var u;const{companyName:a,companyBlock:n,templateBlocks:i,justification:s,majorUpdateJustifications:m,onPrev:o,onClose:r}=e,{t:l}=S(),p=oe("primary.500","primary.300"),g=[`**Justification:** ${s||"(REPLACE ME)"}`,Object.entries(m).map(([C,O])=>`- Major update of ${C}: ${O}`).join(`
`),ze,(u=n==null?void 0:n.outerHTML)!=null?u:"",...i.map(C=>C.outerHTML)].join(`

`),c=new URLSearchParams({template:"new-templates-request.md",label:"resources",title:"Resources: New templates of "+a}),f=async()=>{await navigator.clipboard.writeText(g)};return d(T,{children:[d(_,{children:[t(V,{children:l("Follow the instructions below to open an Issue")+":"}),d(ie,{children:[d(k,{children:[l("Open")," ",d(se,{color:p,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+c.toString(),isExternal:!0,children:["Issue: New Templates Request ",t(Q,{as:Ie})]})]}),d(k,{children:[l("Click copy button and paste into issue body")," ",t(b,{size:"xs",leftIcon:t(Re,{}),onClick:f,children:l("Copy")})]})]})]}),d(D,{children:[t(b,{variant:"ghost",onClick:o,mr:"auto",leftIcon:t(He,{}),children:l("Previous")}),t(b,{colorScheme:"primary",onClick:r,children:l("Close")})]})]})}function De(e){const{isOpen:a,onClose:n}=e,{t:i}=S(),[s,m]=x.useState([]),[o,r]=x.useState({}),[l,p]=x.useState(""),[g,c]=x.useState({}),[f,u]=x.useState(!1),{companyConfig:C,templateList:O}=L(y=>y.app),w=L(y=>y.ticket),R=E.getCompanyEnglishName(w,C),H=E.getCompanyBlock(w),P=E.getTemplateBlocks(w);x.useEffect(()=>{if(a){m(E.getCompanyErrors(w)),r(E.getTemplateErrors(w));const y=E.getMajorUpdateNames(w,O).reduce((M,J)=>({...M,[J]:""}),{});c(y)}else p(""),c({}),u(!1)},[a]);const h=s.length>0||Object.values(o).flat().length>0,v=!h&&!f;return d(re,{blockScrollOnMount:!1,isOpen:a,onClose:n,scrollBehavior:"inside",children:[t(le,{}),d(ce,{children:[t(de,{children:i("Submit templates")}),t(me,{}),h&&t(Ue,{companyErrors:s,templateErrors:o,onClose:n}),v&&t(_e,{justification:l,majorUpdateJustifications:g,onJustificationChange:p,onMajorUpdateJustificationChange:(y,M)=>c(J=>({...J,[y]:M})),onNext:()=>u(!0)}),!h&&f&&t(Ve,{companyName:R,companyBlock:H,templateBlocks:P,justification:l,majorUpdateJustifications:g,onPrev:()=>u(!1),onClose:n})]})]})}const Ge={px:2,pt:2,width:{base:"100%",md:520},"& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto"},"& > div:nth-of-type(2)":{my:2}};function Ye(){const{t:e}=S(),a=he(),n=G(),[i,s]=x.useState(!1),m=()=>{n(xe()),pe.event(Le.RESET_TICKETS,{})};return d(ue,{sx:Ge,children:[d(F,{children:[t(Ne,{}),t(Fe,{})]}),d(F,{children:[t(b,{size:"sm",onClick:()=>a("/"),children:e("Go back")}),d(U,{ml:"auto",children:[t(b,{size:"sm",variant:"outline",onClick:m,children:e("Reset")}),t(b,{size:"sm",colorScheme:"primary",onClick:()=>s(!0),children:e("Submit")})]})]}),t(De,{isOpen:i,onClose:()=>s(!1)})]})}export{Ye as default};
