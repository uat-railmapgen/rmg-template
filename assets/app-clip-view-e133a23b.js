import{j as t,t as y,v as L,X as T,Y as _,r as P}from"./chakra-4d1cedbe.js";import{u as A,r as i,R as $,a as O}from"./index-3acebf78.js";import{P as M,T as N}from"./templates-grid-0949bd26.js";import{u as b,k,r as a}from"./react-d5c86316.js";import{u as w,E as p}from"./use-templates-2a4aa325.js";const D="rmg-templates-bridge--";function F(){const{t:m}=b(),C=w(),[u]=k(),I=u.get("parentId"),o=u.get("parentComponent"),{selectedCompany:r}=A(e=>e.app),[c,l]=a.useState(),[x,d]=a.useState(!1),[h,f]=a.useState(!1),s=a.useRef();a.useEffect(()=>{var e;return s.current=new BroadcastChannel(D+I),i.event(p.APP_CLIP_VIEW_OPENED,{parentComponent:o}),console.log(`[${(e=s.current)==null?void 0:e.name}] App clip connection established, parentComponent=${o}`),()=>{var n;(n=s.current)==null||n.close()}},[]),a.useEffect(()=>{l(void 0)},[r]);const j=async()=>{var g,E;if(!c)return;const{filename:e,name:n}=c;console.log(`[${(g=s.current)==null?void 0:g.name}] Emitting IMPORT event, company=${r}, template=${e}`);try{d(!0);const S=await(await fetch(`/rmg-templates/resources/templates/${r}/${e}.json`)).json();(E=s.current)==null||E.postMessage({event:"IMPORT",meta:{company:r,filename:e,name:C(n)},data:S}),i.event(p.APP_CLIP_VIEW_IMPORT,{parentComponent:o,company:r,filename:e})}catch(R){f(!0)}finally{d(!1),l(void 0)}},v=()=>{var e,n;console.log(`[${(e=s.current)==null?void 0:e.name}] Emitting CLOSE event`),(n=s.current)==null||n.postMessage({event:"CLOSE"}),i.event(p.APP_CLIP_VIEW_CLOSED,{parentComponent:o}),l(void 0),f(!1)};return t.jsxs(t.Fragment,{children:[t.jsxs($,{children:[x&&t.jsx(O,{isIndeterminate:!0}),h&&t.jsxs(y,{status:"error",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[t.jsx(L,{}),m("Unable to import selected template.")]}),t.jsx(M,{}),t.jsx(N,{selectedTemplate:c,onTemplateSelect:l})]}),t.jsx(T,{}),t.jsxs(_,{p:2,justifyContent:"flex-end",children:[t.jsx(P,{size:"sm",onClick:v,children:m("Close")}),t.jsx(P,{size:"sm",colorScheme:"primary",isDisabled:!c,onClick:j,children:m("Import")})]})]})}export{F as default};
